(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{3272:function(e,t,a){Promise.resolve().then(a.bind(a,5266))},5266:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return page}});var r=a(7437),s=a(2265),o=a(4033),l=a(1396),n=a.n(l),i=a(680),u=a(372),c=a.n(u),d=a(8529),h=a.n(d),g=a(192),m=a.n(g),Modal_Modal=e=>{let{isOpen:t,onRequestClose:a,contentLabel:s,children:o}=e;return(0,r.jsxs)(h(),{isOpen:t,onRequestClose:a,contentLabel:s,className:m().modal,overlayClassName:m().overlay,ariaHideApp:!1,children:[(0,r.jsx)("button",{onClick:a,className:m().closeButton,"aria-label":"Закрыть модальное окно",children:"\xd7"}),o]})},_=a(6691),p=a.n(_),page=()=>{let{register:e}=(0,i.a)(),t=(0,o.useRouter)(),[a,l]=(0,s.useState)({username:"",email:"",password:""}),[u,d]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1),handleChange=e=>l({...a,[e.target.name]:e.target.value}),handleSubmit=async r=>{r.preventDefault(),console.log("Данные для отправки:",a);try{let r=await e(a.username,a.email,a.password);console.log("Результат регистрации:",r),r.success?(console.log("Перенаправление на главную"),t.push("/")):d(r.message)}catch(e){console.error("Ошибка регистрации:",e),d("Ошибка регистрации. Попробуйте позже.")}};return(0,r.jsx)("section",{className:c().auth,children:(0,r.jsxs)("div",{className:c().authContainer,children:[(0,r.jsx)("div",{className:c().authDecoration,children:(0,r.jsx)(p(),{src:"/images/decorations/registr_siren.svg",width:583,height:321,alt:"Login Decoration"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:c().authTitle,children:"РЕЄСТРАЦІЯ"}),u&&(0,r.jsx)("p",{className:c().error,children:u}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:c().authForm,children:[(0,r.jsx)("label",{htmlFor:"username",children:"Будь ласка, введіть своє ім'я"}),(0,r.jsx)("input",{type:"text",name:"username",id:"username",value:a.username,onChange:handleChange,placeholder:"Ім'я",required:!0}),(0,r.jsx)("label",{htmlFor:"email",children:"Будь ласка, введіть свою електронну адресу"}),(0,r.jsx)("input",{type:"email",name:"email",id:"email",value:a.email,onChange:handleChange,placeholder:"Електронна адреса",required:!0}),(0,r.jsx)("label",{htmlFor:"password",children:"Будь ласка, введіть свій пароль"}),(0,r.jsx)("input",{type:"password",name:"password",id:"password",value:a.password,onChange:handleChange,placeholder:"Пароль",required:!0}),(0,r.jsx)("button",{type:"submit",className:c().submitButton,children:"Зареєструватися"})]}),(0,r.jsx)("p",{className:c().authLink,children:(0,r.jsx)(n(),{href:"/auth/login",children:"У МЕНЕ ВЖЕ Є ПРОФІЛЬ"})})]}),(0,r.jsxs)(Modal_Modal,{isOpen:h,onRequestClose:()=>g(!1),contentLabel:"Ошибка Регистрации",children:[(0,r.jsx)("h2",{children:"Ошибка Регистрации"}),(0,r.jsx)("p",{children:"Эта почта уже зарегистрирована."}),(0,r.jsx)("button",{onClick:()=>g(!1),className:c().closeModalButton,children:"Закрыть"})]})]})})}},680:function(e,t,a){"use strict";a.d(t,{H:function(){return AuthProvider},a:function(){return useAuth}});var r=a(7437),s=a(2265),o=a(6454),l=a(2164);let n=(0,s.createContext)(void 0),useAuth=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},AuthProvider=e=>{let{children:t}=e,[a,i]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem("jwt"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);i(e)}catch(e){console.error("Ошибка восстановления пользователя:",e),localStorage.removeItem("jwt"),localStorage.removeItem("user")}},[]);let register=async(e,t,a)=>{try{let r=await (0,o.a$)(e,t,a),{jwt:s,user:l}=r.data;return localStorage.setItem("jwt",s),localStorage.setItem("user",JSON.stringify(l)),i(l),{success:!0,data:r.data}}catch(e){if(e instanceof l.d7){var r,s,n;return{success:!1,message:(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:null===(r=s.error)||void 0===r?void 0:r.message)||"Ошибка регистрации"}}return{success:!1,message:"Произошла неизвестная ошибка"}}},login=async(e,t)=>{try{let a=await (0,o.pH)(e,t),{jwt:r,user:s}=a.data;return localStorage.setItem("jwt",r),localStorage.setItem("user",JSON.stringify(s)),i(s),!0}catch(e){return console.error("Ошибка логина:",e),!1}};return(0,r.jsx)(n.Provider,{value:{register,login,user:a,logout:()=>{i(null),localStorage.removeItem("jwt"),localStorage.removeItem("user")}},children:t})}},6454:function(e,t,a){"use strict";a.d(t,{a$:function(){return registerUser},pH:function(){return loginUser}});var r=a(4829);let s=r.default.create({baseURL:"https://siren-store.onrender.com"});s.interceptors.request.use(e=>{let t=localStorage.getItem("jwt");return t&&"/api/auth/local/register"!==e.url&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e));let registerUser=async(e,t,a)=>{console.log("Данные для API:",{username:e,email:t,password:a});try{let r=await s.post("/api/auth/local/register",{username:e,email:t,password:a});return console.log("Успешный ответ от API:",r.data),{success:!0,data:r.data}}catch(e){var r,o,l,n;return console.error("Ошибка в запросе API:",(null===(r=e.response)||void 0===r?void 0:r.data)||e.message),{success:!1,message:(null===(n=e.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:null===(o=l.error)||void 0===o?void 0:o.message)||"Ошибка регистрации"}}},loginUser=async(e,t)=>{try{let a=await s.post("/api/auth/local",{identifier:e,password:t});return console.log("Логин успешен:",a.data),a}catch(e){var a;throw console.error("Ошибка логина:",(null===(a=e.response)||void 0===a?void 0:a.data)||e.message),e}};t.ZP=s},372:function(e){e.exports={auth:"RegistrPage_auth__qgQ_4",authContainer:"RegistrPage_authContainer__AM589",authTitle:"RegistrPage_authTitle__Hcduc",authForm:"RegistrPage_authForm__vNX_W",authDecoration:"RegistrPage_authDecoration__I0kTL",authLink:"RegistrPage_authLink__zXtVu",error:"RegistrPage_error__zfxtT",modal:"RegistrPage_modal__l6Zr_",closeModalButton:"RegistrPage_closeModalButton__rJFjT"}},192:function(e){e.exports={overlay:"Modal_overlay__2Sh3U",modal:"Modal_modal__JNobJ",closeButton:"Modal_closeButton__7VSKG"}}},function(e){e.O(0,[413,326,787,298,971,472,744],function(){return e(e.s=3272)}),_N_E=e.O()}]);